/*!
 * ClockPicker v{package.version} (http://weareoutman.github.io/clockpicker/)
 * Copyright 2014 Wang Shenwei.
 * Licensed under MIT (https://github.com/weareoutman/clockpicker/blob/gh-pages/LICENSE)
 */
(function(){function o(n){return document.createElementNS(k,n)}function s(n){return(n<10?"0":"")+n}function it(n){var t=++tt+"";return n?n+t:t}function t(t,v){function vt(n,t){var b=st.offset(),k=/^touch/.test(n.type),s=b.left+i,c=b.top+i,f=(k?n.originalEvent.touches[0]:n).pageX-s,o=(k?n.originalEvent.touches[0]:n).pageY-c,d=Math.sqrt(f*f+o*o),l=!1,g;if(!t||!(d<r-u||d>r+u)){n.preventDefault();g=setTimeout(function(){a.addClass("clockpicker-moving")},200);h&&st.append(nt.canvas);nt.setHand(f,o,!t,!0);e.off(y).on(y,function(n){n.preventDefault();var t=/^touch/.test(n.type),i=(t?n.originalEvent.touches[0]:n).pageX-s,r=(t?n.originalEvent.touches[0]:n).pageY-c;(l||i!==f||r!==o)&&(l=!0,nt.setHand(i,r,!1,!0))});e.off(p).on(p,function(n){e.off(p);n.preventDefault();var i=/^touch/.test(n.type),r=(i?n.originalEvent.changedTouches[0]:n).pageX-s,u=(i?n.originalEvent.changedTouches[0]:n).pageY-c;(t||l)&&r===f&&u===o&&nt.setHand(r,u);nt.currentView==="hours"?nt.toggleView("minutes",w/2):v.autoclose&&(nt.minutesView.addClass("clockpicker-dial-out"),setTimeout(function(){nt.done()},w/2));st.prepend(yt);clearTimeout(g);a.removeClass("clockpicker-moving");e.off(y)})}}var d=n(rt),st=d.find(".clockpicker-plate"),pt=d.find(".clockpicker-hours"),bt=d.find(".clockpicker-minutes"),ti=d.find(".clockpicker-am-pm-block"),kt=t.prop("tagName")==="INPUT",dt=kt?t:t.find("input"),gt=t.find(".input-group-addon"),nt=this,ni,ii,at,b,k,tt,et,wt,yt,ot,ut,ft,ht,ct,lt;this.id=it("cp");this.element=t;this.options=v;this.isAppended=!1;this.isShown=!1;this.currentView="hours";this.isInput=kt;this.input=dt;this.addon=gt;this.popover=d;this.plate=st;this.hoursView=pt;this.minutesView=bt;this.amPmBlock=ti;this.spanHours=d.find(".clockpicker-span-hours");this.spanMinutes=d.find(".clockpicker-span-minutes");this.spanAmPm=d.find(".clockpicker-span-am-pm");this.amOrPm="PM";v.twelvehour&&(ni='<div class="clockpicker-am-pm-block"><button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-am-button">AM<\/button><button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-pm-button">PM<\/button><\/div>',ii=n(ni),n('<button type="button" class="btn btn-sm btn-default clockpicker-button am-button">AM<\/button>').on("click",function(){nt.amOrPm="AM";n(".clockpicker-span-am-pm").empty().append("AM")}).appendTo(this.amPmBlock),n('<button type="button" class="btn btn-sm btn-default clockpicker-button pm-button">PM<\/button>').on("click",function(){nt.amOrPm="PM";n(".clockpicker-span-am-pm").empty().append("PM")}).appendTo(this.amPmBlock));v.autoclose||n('<button type="button" class="btn btn-sm btn-default btn-block clockpicker-button">'+v.donetext+"<\/button>").click(n.proxy(this.done,this)).appendTo(d);(v.placement==="top"||v.placement==="bottom")&&(v.align==="top"||v.align==="bottom")&&(v.align="left");(v.placement==="left"||v.placement==="right")&&(v.align==="left"||v.align==="right")&&(v.align="top");d.addClass(v.placement);d.addClass("clockpicker-align-"+v.align);this.spanHours.click(n.proxy(this.toggleView,this,"hours"));this.spanMinutes.click(n.proxy(this.toggleView,this,"minutes"));dt.on("focus.clockpicker click.clockpicker",n.proxy(this.show,this));gt.on("click.clockpicker",n.proxy(this.toggle,this));if(at=n('<div class="clockpicker-tick"><\/div>'),v.twelvehour)for(b=1;b<13;b+=1){k=at.clone();tt=b/6*Math.PI;et=r;k.css("font-size","120%");k.css({left:i+Math.sin(tt)*et-u,top:i-Math.cos(tt)*et-u});k.html(b===0?"00":b);pt.append(k);k.on(c,vt)}else for(b=0;b<24;b+=1){k=at.clone();tt=b/6*Math.PI;wt=b>0&&b<13;et=wt?l:r;k.css({left:i+Math.sin(tt)*et-u,top:i-Math.cos(tt)*et-u});wt&&k.css("font-size","120%");k.html(b===0?"00":b);pt.append(k);k.on(c,vt)}for(b=0;b<60;b+=5){k=at.clone();tt=b/30*Math.PI;k.css({left:i+Math.sin(tt)*r-u,top:i-Math.cos(tt)*r-u});k.css("font-size","120%");k.html(s(b));bt.append(k);k.on(c,vt)}st.on(c,function(t){n(t.target).closest(".clockpicker-tick").length===0&&vt(t,!0)});h&&(yt=d.find(".clockpicker-canvas"),ot=o("svg"),ot.setAttribute("class","clockpicker-svg"),ot.setAttribute("width",g),ot.setAttribute("height",g),ut=o("g"),ut.setAttribute("transform","translate("+i+","+i+")"),ft=o("circle"),ft.setAttribute("class","clockpicker-canvas-bearing"),ft.setAttribute("cx",0),ft.setAttribute("cy",0),ft.setAttribute("r",2),ht=o("line"),ht.setAttribute("x1",0),ht.setAttribute("y1",0),ct=o("circle"),ct.setAttribute("class","clockpicker-canvas-bg"),ct.setAttribute("r",u),lt=o("circle"),lt.setAttribute("class","clockpicker-canvas-fg"),lt.setAttribute("r",3.5),ut.appendChild(ht),ut.appendChild(ct),ut.appendChild(lt),ut.appendChild(ft),ot.appendChild(ut),yt.append(ot),this.hand=ht,this.bg=ct,this.fg=lt,this.bearing=ft,this.g=ut,this.canvas=yt);f(this.options.init)}function f(n){n&&typeof n=="function"&&n()}var n=window.jQuery,b=n(window),e=n(document),a,k="http://www.w3.org/2000/svg",h="SVGAngle"in window&&function(){var t,n=document.createElement("div");return n.innerHTML="<svg/>",t=(n.firstChild&&n.firstChild.namespaceURI)==k,n.innerHTML="",t}(),nt=function(){var n=document.createElement("div").style;return"transition"in n||"WebkitTransition"in n||"MozTransition"in n||"msTransition"in n||"OTransition"in n}(),v="ontouchstart"in window,c="mousedown"+(v?" touchstart":""),y="mousemove.clockpicker"+(v?" touchmove.clockpicker":""),p="mouseup.clockpicker"+(v?" touchend.clockpicker":""),d=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null,tt=0,i=100,r=80,l=54,u=13,g=i*2,w=nt?350:1,rt='<div class="popover clockpicker-popover"><div class="arrow"><\/div><div class="popover-title"><span class="clockpicker-span-hours text-primary"><\/span> : <span class="clockpicker-span-minutes"><\/span><span class="clockpicker-span-am-pm"><\/span><\/div><div class="popover-content"><div class="clockpicker-plate"><div class="clockpicker-canvas"><\/div><div class="clockpicker-dial clockpicker-hours"><\/div><div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"><\/div><\/div><span class="clockpicker-am-pm-block"><\/span><\/div><\/div>';t.DEFAULTS={"default":"",fromnow:0,placement:"bottom",align:"left",donetext:"完成",autoclose:!1,twelvehour:!1,vibrate:!0};t.prototype.toggle=function(){this[this.isShown?"hide":"show"]()};t.prototype.locate=function(){var r=this.element,i=this.popover,t=r.offset(),u=r.outerWidth(),f=r.outerHeight(),e=this.options.placement,o=this.options.align,n={},s=this;i.show();switch(e){case"bottom":n.top=t.top+f;break;case"right":n.left=t.left+u;break;case"top":n.top=t.top-i.outerHeight();break;case"left":n.left=t.left-i.outerWidth()}switch(o){case"left":n.left=t.left;break;case"right":n.left=t.left+u-i.outerWidth();break;case"top":n.top=t.top;break;case"bottom":n.top=t.top+f-i.outerHeight()}i.css(n)};t.prototype.show=function(){var t,i,r;if(!this.isShown){if(f(this.options.beforeShow),t=this,!this.isAppended){a=n(document.body).append(this.popover);b.on("resize.clockpicker"+this.id,function(){t.isShown&&t.locate()});this.isAppended=!0}i=((this.input.prop("value")||this.options["default"]||"")+"").split(":");i[0]==="now"&&(r=new Date(+new Date+this.options.fromnow),i=[r.getHours(),r.getMinutes()]);this.hours=+i[0]||0;this.minutes=+i[1]||0;this.spanHours.html(s(this.hours));this.spanMinutes.html(s(this.minutes));this.toggleView("hours");this.locate();this.isShown=!0;e.on("click.clockpicker."+this.id+" focusin.clockpicker."+this.id,function(i){var r=n(i.target);r.closest(t.popover).length===0&&r.closest(t.addon).length===0&&r.closest(t.input).length===0&&t.hide()});e.on("keyup.clockpicker."+this.id,function(n){n.keyCode===27&&t.hide()});f(this.options.afterShow)}};t.prototype.hide=function(){f(this.options.beforeHide);this.isShown=!1;e.off("click.clockpicker."+this.id+" focusin.clockpicker."+this.id);e.off("keyup.clockpicker."+this.id);this.popover.hide();f(this.options.afterHide)};t.prototype.toggleView=function(t,i){var u=!1;t==="minutes"&&n(this.hoursView).css("visibility")==="visible"&&(f(this.options.beforeHourSelect),u=!0);var r=t==="hours",o=r?this.hoursView:this.minutesView,e=r?this.minutesView:this.hoursView;this.currentView=t;this.spanHours.toggleClass("text-primary",r);this.spanMinutes.toggleClass("text-primary",!r);e.addClass("clockpicker-dial-out");o.css("visibility","visible").removeClass("clockpicker-dial-out");this.resetClock(i);clearTimeout(this.toggleViewTimer);this.toggleViewTimer=setTimeout(function(){e.css("visibility","hidden")},w);u&&f(this.options.afterHourSelect)};t.prototype.resetClock=function(n){var u=this.currentView,t=this[u],f=u==="hours",a=Math.PI/(f?6:30),e=t*a,o=f&&t>0&&t<13?l:r,s=Math.sin(e)*o,c=-Math.cos(e)*o,i=this;h&&n?(i.canvas.addClass("clockpicker-canvas-out"),setTimeout(function(){i.canvas.removeClass("clockpicker-canvas-out");i.setHand(s,c)},n)):this.setHand(s,c)};t.prototype.setHand=function(t,i,u,f){var o=Math.atan2(t,-i),c=this.currentView==="hours",p=Math.PI/(c||u?6:30),k=Math.sqrt(t*t+i*i),w=this.options,b=c&&k<(r+l)/2,y=b?l:r,e,a,v;if(w.twelvehour&&(y=r),o<0&&(o=Math.PI*2+o),e=Math.round(o/p),o=e*p,w.twelvehour?c?e===0&&(e=12):(u&&(e*=5),e===60&&(e=0)):c?(e===12&&(e=0),e=b?e===0?12:e:e===0?0:e+12):(u&&(e*=5),e===60&&(e=0)),this[this.currentView]!==e&&d&&this.options.vibrate&&(this.vibrateTimer||(navigator[d](10),this.vibrateTimer=setTimeout(n.proxy(function(){this.vibrateTimer=null},this),100))),this[this.currentView]=e,this[c?"spanHours":"spanMinutes"].html(s(e)),!h){this[c?"hoursView":"minutesView"].find(".clockpicker-tick").each(function(){var t=n(this);t.toggleClass("active",e===+t.html())});return}f||!c&&e%5?(this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")):(this.g.insertBefore(this.hand,this.bg),this.g.insertBefore(this.fg,this.bg),this.bg.setAttribute("class","clockpicker-canvas-bg"));a=Math.sin(o)*y;v=-Math.cos(o)*y;this.hand.setAttribute("x2",a);this.hand.setAttribute("y2",v);this.bg.setAttribute("cx",a);this.bg.setAttribute("cy",v);this.fg.setAttribute("cx",a);this.fg.setAttribute("cy",v)};t.prototype.done=function(){f(this.options.beforeDone);this.hide();var t=this.input.prop("value"),n=s(this.hours)+":"+s(this.minutes);this.options.twelvehour&&(n=n+this.amOrPm);this.input.prop("value",n);n!==t&&(this.input.triggerHandler("change"),this.isInput||this.element.trigger("change"));this.options.autoclose&&this.input.trigger("blur");f(this.options.afterDone)};t.prototype.remove=function(){this.element.removeData("clockpicker");this.input.off("focus.clockpicker click.clockpicker");this.addon.off("click.clockpicker");this.isShown&&this.hide();this.isAppended&&(b.off("resize.clockpicker"+this.id),this.popover.remove())};n.fn.clockpicker=function(i){var r=Array.prototype.slice.call(arguments,1);return this.each(function(){var u=n(this),f=u.data("clockpicker"),e;f?typeof f[i]=="function"&&f[i].apply(f,r):(e=n.extend({},t.DEFAULTS,u.data(),typeof i=="object"&&i),u.data("clockpicker",new t(u,e)))})}})();